<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMS Pro - Professional SMS Dashboard</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Toastify CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --accent-color: #4cc9f0;
            --success-color: #4ade80;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --dark-bg: #0f172a;
            --card-bg: rgba(255, 255, 255, 0.05);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
        }
        
        .light-mode {
            --dark-bg: #f8fafc;
            --card-bg: #ffffff;
            --glass-bg: rgba(255, 255, 255, 0.7);
            --text-primary: #1e293b;
            --text-secondary: #64748b;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Hind Siliguri', sans-serif;
            background: linear-gradient(135deg, var(--dark-bg) 0%, #1e293b 100%);
            color: var(--text-primary);
            min-height: 100vh;
            transition: all 0.3s ease;
        }
        
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .card {
            background: var(--card-bg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
        }
        
        .navbar {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Balance Display */
        .balance-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }
        
        .balance-icon {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        /* Tab Navigation */
        .nav-tabs {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .nav-tabs .nav-link {
            color: var(--text-secondary);
            border: none;
            padding: 12px 25px;
            border-radius: 10px 10px 0 0;
            transition: all 0.3s;
        }
        
        .nav-tabs .nav-link.active {
            color: var(--accent-color);
            background: var(--card-bg);
            border-bottom: 3px solid var(--accent-color);
        }
        
        /* Form Elements */
        .form-control, .form-select {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            border-radius: 10px;
            padding: 12px 15px;
            transition: all 0.3s;
        }
        
        .form-control:focus, .form-select:focus {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--accent-color);
            color: var(--text-primary);
            box-shadow: 0 0 0 0.25rem rgba(76, 201, 240, 0.25);
        }
        
        .form-control::placeholder {
            color: var(--text-secondary);
        }
        
        /* Buttons */
        .btn-primary {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            border: none;
            border-radius: 10px;
            padding: 12px 25px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.4);
        }
        
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-outline-accent {
            border: 2px solid var(--accent-color);
            color: var(--accent-color);
            background: transparent;
            border-radius: 10px;
            padding: 10px 20px;
            transition: all 0.3s;
        }
        
        .btn-outline-accent:hover {
            background: var(--accent-color);
            color: white;
        }
        
        /* Character Counter */
        .char-counter {
            position: absolute;
            right: 10px;
            bottom: 10px;
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
        }
        
        /* History Table */
        .history-table {
            background: var(--card-bg);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .history-table thead {
            background: rgba(67, 97, 238, 0.1);
        }
        
        .history-table th {
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            padding: 15px;
            font-weight: 600;
        }
        
        .history-table td {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        /* Contacts List */
        .contact-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: background 0.3s;
        }
        
        .contact-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .contact-actions button {
            margin-left: 5px;
            padding: 5px 10px;
            font-size: 12px;
        }
        
        /* Bulk Input */
        .bulk-hint {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 5px;
        }
        
        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .balance-card {
                padding: 20px;
            }
            
            .nav-tabs .nav-link {
                padding: 10px 15px;
                font-size: 14px;
            }
            
            .history-table {
                font-size: 14px;
            }
            
            .history-table th,
            .history-table td {
                padding: 8px 10px;
            }
        }
        
        @media (max-width: 576px) {
            .container {
                padding: 10px;
            }
            
            .card {
                padding: 15px !important;
            }
            
            .balance-icon {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
        }
        
        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color);
        }
        
        /* Theme Toggle */
        .theme-toggle {
            width: 50px;
            height: 26px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 13px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .theme-toggle.active {
            background: var(--accent-color);
        }
        
        .theme-toggle::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: transform 0.3s;
        }
        
        .theme-toggle.active::after {
            transform: translateX(24px);
        }
        
        /* Status Badges */
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-success {
            background: rgba(74, 222, 128, 0.2);
            color: #4ade80;
        }
        
        .status-error {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        
        .status-pending {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container">
            <a class="navbar-brand fw-bold d-flex align-items-center" href="#">
                <i class="fas fa-sms me-2"></i>
                <span>SMS Pro</span>
                <span class="badge bg-accent ms-2" style="background: var(--accent-color);">Beta</span>
            </a>
            
            <div class="d-flex align-items-center">
                <!-- Theme Toggle -->
                <div class="theme-toggle me-3" id="themeToggle"></div>
                
                <!-- User Points Badge -->
                <div class="d-none d-md-flex align-items-center me-3">
                    <i class="fas fa-coins text-warning me-2"></i>
                    <span id="userPointsBadge" class="fw-bold">100</span>
                </div>
                
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#sendSmsTab">
                            <i class="fas fa-paper-plane me-1"></i> Send SMS
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#historyTab">
                            <i class="fas fa-history me-1"></i> History
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#contactsTab">
                            <i class="fas fa-address-book me-1"></i> Contacts
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#settingsTab">
                            <i class="fas fa-cog me-1"></i> Settings
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Balance Display -->
        <div class="balance-card glass-card fade-in">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h5 class="mb-2">Your SMS Points Balance</h5>
                    <h1 class="display-4 fw-bold mb-0" id="balanceDisplay">100</h1>
                    <p class="mb-0 text-light">Points remaining for SMS sending</p>
                </div>
                <div class="col-md-4 text-end">
                    <div class="balance-icon d-inline-flex">
                        <i class="fas fa-coins"></i>
                    </div>
                    <div class="mt-3">
                        <small class="text-light">1 Point = 1 SMS (160 chars English / 70 chars Unicode)</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div class="glass-card p-4 mb-4">
            <!-- Tab Navigation -->
            <ul class="nav nav-tabs mb-4" id="dashboardTabs">
                <li class="nav-item">
                    <a class="nav-link active" id="sendSmsTab" data-bs-toggle="tab" href="#sendSms">
                        <i class="fas fa-paper-plane me-2"></i> Send SMS
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="historyTab" data-bs-toggle="tab" href="#history">
                        <i class="fas fa-history me-2"></i> History
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="contactsTab" data-bs-toggle="tab" href="#contacts">
                        <i class="fas fa-address-book me-2"></i> Contacts
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="settingsTab" data-bs-toggle="tab" href="#settings">
                        <i class="fas fa-cog me-2"></i> Settings
                    </a>
                </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content">
                <!-- Send SMS Tab -->
                <div class="tab-pane fade show active" id="sendSms">
                    <div class="row">
                        <div class="col-lg-8">
                            <div class="card p-4 mb-4">
                                <h5 class="mb-4"><i class="fas fa-mobile-alt me-2"></i> Send SMS</h5>
                                
                                <!-- Phone Input -->
                                <div class="mb-4">
                                    <label class="form-label fw-bold">Phone Number(s)</label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-transparent">+88</span>
                                        <input type="text" class="form-control" id="phoneNumbers" 
                                               placeholder="01712345678 or 01712345678,01876543219" required>
                                        <button class="btn btn-outline-accent" type="button" id="addFromContacts">
                                            <i class="fas fa-address-book"></i>
                                        </button>
                                    </div>
                                    <div class="bulk-hint mt-1">
                                        Multiple numbers: Separate with comma (,). Max 10 numbers per request.
                                    </div>
                                    <div class="d-flex flex-wrap gap-2 mt-2" id="selectedContacts">
                                        <!-- Selected contacts will appear here -->
                                    </div>
                                </div>
                                
                                <!-- Message Input -->
                                <div class="mb-4">
                                    <label class="form-label fw-bold">Message</label>
                                    <div class="position-relative">
                                        <textarea class="form-control" id="message" rows="5" 
                                                  placeholder="Type your message here..." 
                                                  maxlength="1600" required></textarea>
                                        <div class="char-counter" id="charCounter">0/160</div>
                                    </div>
                                    <div class="d-flex justify-content-between mt-2">
                                        <div>
                                            <span class="badge bg-primary me-2" id="messageType">English</span>
                                            <span class="text-muted" id="smsCount">SMS: 0</span>
                                            <span class="text-muted ms-2" id="pointCost">Cost: 0 points</span>
                                        </div>
                                        <div>
                                            <button class="btn btn-sm btn-outline-accent" id="saveTemplateBtn">
                                                <i class="fas fa-save me-1"></i> Save Template
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Contact Saving -->
                                <div class="mb-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="saveContactCheck">
                                        <label class="form-check-label">
                                            Save this number as contact
                                        </label>
                                    </div>
                                    <div class="mt-2" id="contactNameField" style="display: none;">
                                        <input type="text" class="form-control" id="contactName" 
                                               placeholder="Contact name (optional)">
                                    </div>
                                </div>
                                
                                <!-- Send Button -->
                                <button class="btn btn-primary w-100 py-3" id="sendBtn" disabled>
                                    <span id="btnText">
                                        <i class="fas fa-paper-plane me-2"></i> Send SMS
                                    </span>
                                    <span class="spinner d-none" id="btnSpinner"></span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Quick Stats Sidebar -->
                        <div class="col-lg-4">
                            <div class="card p-4 mb-4">
                                <h6 class="mb-3"><i class="fas fa-chart-bar me-2"></i> Quick Stats</h6>
                                <div class="mb-3">
                                    <small class="text-muted">Today's Usage</small>
                                    <h4 id="todayUsage">0 SMS</h4>
                                </div>
                                <div class="mb-3">
                                    <small class="text-muted">This Month</small>
                                    <h4 id="monthUsage">0 SMS</h4>
                                </div>
                                <div class="mb-3">
                                    <small class="text-muted">Total Sent</small>
                                    <h4 id="totalSent">0 SMS</h4>
                                </div>
                                <hr>
                                <div>
                                    <small class="text-muted">Point Rate</small>
                                    <div class="d-flex justify-content-between">
                                        <span>English SMS:</span>
                                        <span>1 point / 160 chars</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span>Unicode SMS:</span>
                                        <span>1 point / 70 chars</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Saved Templates -->
                            <div class="card p-4">
                                <h6 class="mb-3"><i class="fas fa-sticky-note me-2"></i> Saved Templates</h6>
                                <div id="templatesList">
                                    <div class="text-center text-muted">No templates saved</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- History Tab -->
                <div class="tab-pane fade" id="history">
                    <div class="card p-4">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h5><i class="fas fa-history me-2"></i> SMS History</h5>
                            <div>
                                <button class="btn btn-outline-accent btn-sm me-2" id="exportHistoryBtn">
                                    <i class="fas fa-download me-1"></i> Export CSV
                                </button>
                                <button class="btn btn-outline-danger btn-sm" id="clearHistoryBtn">
                                    <i class="fas fa-trash me-1"></i> Clear All
                                </button>
                            </div>
                        </div>
                        
                        <div class="table-responsive">
                            <table class="table history-table">
                                <thead>
                                    <tr>
                                        <th>Date & Time</th>
                                        <th>Phone Number</th>
                                        <th>Message</th>
                                        <th>Type</th>
                                        <th>Points</th>
                                        <th>Status</th>
                                        <th>MID</th>
                                    </tr>
                                </thead>
                                <tbody id="historyTableBody">
                                    <!-- History data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="text-center mt-4" id="historyEmpty">
                            <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                            <p class="text-muted">No SMS history found</p>
                        </div>
                    </div>
                </div>

                <!-- Contacts Tab -->
                <div class="tab-pane fade" id="contacts">
                    <div class="row">
                        <div class="col-lg-5">
                            <div class="card p-4 mb-4">
                                <h5 class="mb-4"><i class="fas fa-user-plus me-2"></i> Add New Contact</h5>
                                
                                <div class="mb-3">
                                    <label class="form-label">Phone Number</label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-transparent">+88</span>
                                        <input type="text" class="form-control" id="newContactPhone" 
                                               placeholder="01712345678">
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Contact Name</label>
                                    <input type="text" class="form-control" id="newContactName" 
                                           placeholder="John Doe">
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Group (Optional)</label>
                                    <input type="text" class="form-control" id="newContactGroup" 
                                           placeholder="Family, Friends, Business">
                                </div>
                                
                                <button class="btn btn-primary w-100" id="addContactBtn">
                                    <i class="fas fa-save me-2"></i> Save Contact
                                </button>
                            </div>
                        </div>
                        
                        <div class="col-lg-7">
                            <div class="card p-4">
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <h5 class="mb-0"><i class="fas fa-address-book me-2"></i> Saved Contacts</h5>
                                    <div class="input-group" style="width: 200px;">
                                        <input type="text" class="form-control" id="contactSearch" 
                                               placeholder="Search contacts...">
                                        <span class="input-group-text bg-transparent">
                                            <i class="fas fa-search"></i>
                                        </span>
                                    </div>
                                </div>
                                
                                <div id="contactsList">
                                    <!-- Contacts will be loaded here -->
                                    <div class="text-center text-muted py-4">
                                        <i class="fas fa-users fa-2x mb-3"></i>
                                        <p>No contacts saved yet</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div class="tab-pane fade" id="settings">
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="card p-4 mb-4">
                                <h5 class="mb-4"><i class="fas fa-cog me-2"></i> System Settings</h5>
                                
                                <div class="mb-4">
                                    <h6 class="mb-3">API Configuration</h6>
                                    <div class="mb-3">
                                        <label class="form-label">API Endpoint</label>
                                        <input type="text" class="form-control" id="apiEndpoint" 
                                               value="https://bikroy.com/data/phone_number_login/verifications/phone_login">
                                        <small class="text-muted">Change only if you have a different SMS gateway</small>
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <h6 class="mb-3">Application Settings</h6>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="autoSaveContacts">
                                        <label class="form-check-label">
                                            Automatically save new numbers to contacts
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="showNotifications">
                                        <label class="form-check-label">
                                            Show desktop notifications
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="enableSound">
                                        <label class="form-check-label">
                                            Enable sound notifications
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-6">
                            <div class="card p-4 mb-4">
                                <h5 class="mb-4"><i class="fas fa-database me-2"></i> Data Management</h5>
                                
                                <div class="mb-4">
                                    <h6 class="mb-3">Reset Points</h6>
                                    <p class="text-muted mb-3">Reset your points balance to default (100 points)</p>
                                    <button class="btn btn-outline-warning w-100" id="resetPointsBtn">
                                        <i class="fas fa-redo me-2"></i> Reset Points to 100
                                    </button>
                                </div>
                                
                                <div class="mb-4">
                                    <h6 class="mb-3">Clear All Data</h6>
                                    <p class="text-muted mb-3">Warning: This will delete all history, contacts, and settings</p>
                                    <button class="btn btn-outline-danger w-100" id="clearAllDataBtn">
                                        <i class="fas fa-trash-alt me-2"></i> Clear All Data
                                    </button>
                                </div>
                                
                                <div class="mb-4">
                                    <h6 class="mb-3">Export Data</h6>
                                    <p class="text-muted mb-3">Download all your data as a backup file</p>
                                    <button class="btn btn-outline-accent w-100" id="exportAllDataBtn">
                                        <i class="fas fa-file-export me-2"></i> Export All Data
                                    </button>
                                </div>
                                
                                <div class="mb-4">
                                    <h6 class="mb-3">Import Data</h6>
                                    <p class="text-muted mb-3">Restore data from a backup file</p>
                                    <input type="file" class="form-control mb-2" id="importDataFile" accept=".json">
                                    <button class="btn btn-outline-success w-100" id="importDataBtn">
                                        <i class="fas fa-file-import me-2"></i> Import Data
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="mt-5 py-4 text-center text-muted border-top border-secondary">
        <div class="container">
            <p class="mb-1">SMS Pro - Professional Educational SMS Dashboard</p>
            <p class="mb-0">Developed for educational purposes only. Real SMS sending requires proper API integration.</p>
            <p class="small mt-2">Â© 2024 SMS Pro. All rights reserved.</p>
        </div>
    </footer>

    <!-- Toastify JS -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Main Application Script -->
    <script>
        // Database Structure
        const DB_KEYS = {
            POINTS: "sms_pro_points",
            HISTORY: "sms_pro_history",
            CONTACTS: "sms_pro_contacts",
            TEMPLATES: "sms_pro_templates",
            SETTINGS: "sms_pro_settings",
            STATS: "sms_pro_stats"
        };

        // Application State
        const AppState = {
            points: 100,
            history: [],
            contacts: [],
            templates: [],
            settings: {},
            stats: {},
            isProcessing: false,
            theme: 'dark'
        };

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            loadAppData();
            initializeUI();
            setupEventListeners();
            updateUI();
        });

        // 1. Load Data from Local Storage
        function loadAppData() {
            // Load points
            const savedPoints = localStorage.getItem(DB_KEYS.POINTS);
            AppState.points = savedPoints ? parseInt(savedPoints) : 100;

            // Load history
            const savedHistory = localStorage.getItem(DB_KEYS.HISTORY);
            AppState.history = savedHistory ? JSON.parse(savedHistory) : [];

            // Load contacts
            const savedContacts = localStorage.getItem(DB_KEYS.CONTACTS);
            AppState.contacts = savedContacts ? JSON.parse(savedContacts) : [];

            // Load templates
            const savedTemplates = localStorage.getItem(DB_KEYS.TEMPLATES);
            AppState.templates = savedTemplates ? JSON.parse(savedTemplates) : [];

            // Load settings
            const savedSettings = localStorage.getItem(DB_KEYS.SETTINGS);
            AppState.settings = savedSettings ? JSON.parse(savedSettings) : {
                autoSaveContacts: false,
                showNotifications: true,
                enableSound: false,
                apiEndpoint: "https://bikroy.com/data/phone_number_login/verifications/phone_login"
            };

            // Load stats
            const savedStats = localStorage.getItem(DB_KEYS.STATS);
            AppState.stats = savedStats ? JSON.parse(savedStats) : {
                todayUsage: 0,
                monthUsage: 0,
                totalSent: 0,
                lastReset: new Date().toISOString()
            };

            // Load theme
            AppState.theme = localStorage.getItem('sms_pro_theme') || 'dark';
        }

        // 2. Save Data to Local Storage
        function saveAppData() {
            localStorage.setItem(DB_KEYS.POINTS, AppState.points);
            localStorage.setItem(DB_KEYS.HISTORY, JSON.stringify(AppState.history));
            localStorage.setItem(DB_KEYS.CONTACTS, JSON.stringify(AppState.contacts));
            localStorage.setItem(DB_KEYS.TEMPLATES, JSON.stringify(AppState.templates));
            localStorage.setItem(DB_KEYS.SETTINGS, JSON.stringify(AppState.settings));
            localStorage.setItem(DB_KEYS.STATS, JSON.stringify(AppState.stats));
            localStorage.setItem('sms_pro_theme', AppState.theme);
        }

        // 3. Initialize UI Components
        function initializeUI() {
            // Set theme
            if (AppState.theme === 'light') {
                document.body.classList.add('light-mode');
                document.getElementById('themeToggle').classList.add('active');
            }

            // Update balance display
            updateBalanceDisplay();

            // Load history table
            loadHistoryTable();

            // Load contacts
            loadContactsList();

            // Load templates
            loadTemplatesList();

            // Update stats
            updateStatsDisplay();

            // Apply settings to UI
            applySettingsToUI();
        }

        // 4. Setup Event Listeners
        function setupEventListeners() {
            // Theme toggle
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);

            // Message input events
            const messageInput = document.getElementById('message');
            messageInput.addEventListener('input', updateMessageStats);
            messageInput.addEventListener('input', validateForm);

            // Phone number input
            document.getElementById('phoneNumbers').addEventListener('input', validateForm);

            // Contact saving toggle
            document.getElementById('saveContactCheck').addEventListener('change', function() {
                document.getElementById('contactNameField').style.display = 
                    this.checked ? 'block' : 'none';
            });

            // Add from contacts button
            document.getElementById('addFromContacts').addEventListener('click', showContactsModal);

            // Send button
            document.getElementById('sendBtn').addEventListener('click', sendSMS);

            // Save template button
            document.getElementById('saveTemplateBtn').addEventListener('click', saveTemplate);

            // Add contact button
            document.getElementById('addContactBtn').addEventListener('click', addContact);

            // Contact search
            document.getElementById('contactSearch').addEventListener('input', filterContacts);

            // Export history
            document.getElementById('exportHistoryBtn').addEventListener('click', exportHistory);

            // Clear history
            document.getElementById('clearHistoryBtn').addEventListener('click', clearHistory);

            // Reset points
            document.getElementById('resetPointsBtn').addEventListener('click', resetPoints);

            // Clear all data
            document.getElementById('clearAllDataBtn').addEventListener('click', clearAllData);

            // Export all data
            document.getElementById('exportAllDataBtn').addEventListener('click', exportAllData);

            // Import data
            document.getElementById('importDataBtn').addEventListener('click', importData);

            // Settings checkboxes
            document.getElementById('autoSaveContacts').addEventListener('change', updateSetting);
            document.getElementById('showNotifications').addEventListener('change', updateSetting);
            document.getElementById('enableSound').addEventListener('change', updateSetting);

            // API endpoint
            document.getElementById('apiEndpoint').addEventListener('change', updateSetting);
        }

        // 5. Core Functions

        // Calculate SMS cost
        function calculateSMSCost(message) {
            const isUnicode = /[^\u0000-\u00FF]/.test(message);
            const charLimit = isUnicode ? 70 : 160;
            const smsCount = Math.ceil(message.length / charLimit);
            return smsCount; // 1 point per SMS
        }

        // Validate phone numbers
        function validatePhoneNumbers(numbers) {
            const numberList = numbers.split(',').map(num => num.trim());
            const validNumbers = [];
            const invalidNumbers = [];

            numberList.forEach(num => {
                if (/^01[3-9]\d{8}$/.test(num)) {
                    validNumbers.push(num);
                } else if (num) {
                    invalidNumbers.push(num);
                }
            });

            return {
                valid: validNumbers,
                invalid: invalidNumbers,
                total: numberList.length
            };
        }

        // Update message statistics
        function updateMessageStats() {
            const message = document.getElementById('message').value;
            const isUnicode = /[^\u0000-\u00FF]/.test(message);
            const charLimit = isUnicode ? 70 : 160;
            const smsCount = Math.ceil(message.length / charLimit);
            const cost = smsCount;

            // Update counters
            document.getElementById('charCounter').textContent = 
                `${message.length}/${charLimit}`;
            document.getElementById('messageType').textContent = 
                isUnicode ? 'Unicode' : 'English';
            document.getElementById('messageType').className = 
                isUnicode ? 'badge bg-warning me-2' : 'badge bg-primary me-2';
            document.getElementById('smsCount').textContent = 
                `SMS: ${smsCount}`;
            document.getElementById('pointCost').textContent = 
                `Cost: ${cost} point${cost !== 1 ? 's' : ''}`;

            // Update character counter color
            const charCounter = document.getElementById('charCounter');
            if (message.length > charLimit) {
                charCounter.style.color = 'var(--danger-color)';
            } else if (message.length > charLimit * 0.8) {
                charCounter.style.color = 'var(--warning-color)';
            } else {
                charCounter.style.color = 'var(--text-secondary)';
            }

            // Update form validation
            validateForm();
        }

        // Validate form
        function validateForm() {
            const phoneNumbers = document.getElementById('phoneNumbers').value;
            const message = document.getElementById('message').value;
            const sendBtn = document.getElementById('sendBtn');

            // Validate phone numbers
            const phoneValidation = validatePhoneNumbers(phoneNumbers);
            const hasValidNumbers = phoneValidation.valid.length > 0;

            // Calculate total cost
            const cost = calculateSMSCost(message) * phoneValidation.valid.length;

            // Check if user has enough points
            const hasEnoughPoints = AppState.points >= cost;

            // Enable/disable send button
            sendBtn.disabled = !(hasValidNumbers && message.trim() && hasEnoughPoints);

            return {
                isValid: !sendBtn.disabled,
                cost: cost,
                validNumbers: phoneValidation.valid.length
            };
        }

        // Send SMS via API
        async function sendSMS() {
            const validation = validateForm();
            if (!validation.isValid) {
                showToast('Please check form inputs and ensure sufficient points.', 'error');
                return;
            }

            // Get form data
            const phoneNumbers = document.getElementById('phoneNumbers').value;
            const message = document.getElementById('message').value;
            const saveContact = document.getElementById('saveContactCheck').checked;
            const contactName = document.getElementById('contactName').value;

            // Show loading state
            const sendBtn = document.getElementById('sendBtn');
            const btnText = document.getElementById('btnText');
            const btnSpinner = document.getElementById('btnSpinner');
            
            sendBtn.disabled = true;
            btnText.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i> Processing';
            btnSpinner.classList.remove('d-none');
            AppState.isProcessing = true;

            // Validate phone numbers
            const phoneValidation = validatePhoneNumbers(phoneNumbers);
            const validNumbers = phoneValidation.valid;

            // Calculate cost per number
            const costPerSMS = calculateSMSCost(message);
            const totalCost = costPerSMS * validNumbers.length;

            try {
                // Send SMS to each number
                const results = [];
                for (const phone of validNumbers) {
                    const result = await sendSingleSMS(phone, message);
                    results.push({
                        phone: phone,
                        success: result.success,
                        messageId: result.messageId || null,
                        error: result.error
                    });
                }

                // Process results
                const successfulSends = results.filter(r => r.success);
                const failedSends = results.filter(r => !r.success);

                // Deduct points for successful sends
                if (successfulSends.length > 0) {
                    const successfulCost = costPerSMS * successfulSends.length;
                    AppState.points -= successfulCost;
                    
                    // Update stats
                    updateStats(successfulSends.length);
                    
                    // Add to history
                    successfulSends.forEach(result => {
                        addToHistory(result.phone, message, costPerSMS, result.messageId, 'success');
                    });
                }

                // Add failed sends to history
                failedSends.forEach(result => {
                    addToHistory(result.phone, message, 0, null, 'error', result.error);
                });

                // Save contact if requested
                if (saveContact && validNumbers.length === 1) {
                    const phone = validNumbers[0];
                    addContactToDatabase(phone, contactName || 'Unknown');
                }

                // Save all data
                saveAppData();

                // Update UI
                updateBalanceDisplay();
                loadHistoryTable();

                // Show results
                showToast(
                    `Successfully sent ${successfulSends.length} SMS, ${failedSends.length} failed.`,
                    successfulSends.length > 0 ? 'success' : 'error'
                );

                // Reset form if all successful
                if (failedSends.length === 0) {
                    document.getElementById('phoneNumbers').value = '';
                    document.getElementById('message').value = '';
                    document.getElementById('saveContactCheck').checked = false;
                    document.getElementById('contactNameField').style.display = 'none';
                    document.getElementById('contactName').value = '';
                    updateMessageStats();
                }

            } catch (error) {
                console.error('SMS sending error:', error);
                showToast('Error sending SMS. Please try again.', 'error');
            } finally {
                // Reset button state
                sendBtn.disabled = false;
                btnText.innerHTML = '<i class="fas fa-paper-plane me-2"></i> Send SMS';
                btnSpinner.classList.add('d-none');
                AppState.isProcessing = false;
                validateForm();
            }
        }

        // Send single SMS via API
        async function sendSingleSMS(phone, message) {
            // This is the actual API call to the provided endpoint
            const apiUrl = AppState.settings.apiEndpoint;
            
            try {
                // Format phone number for API
                const formattedPhone = phone.startsWith('01') ? phone : `01${phone}`;
                
                // Make API request
                const response = await fetch(`${apiUrl}?phone=${formattedPhone}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        timestamp: new Date().toISOString()
                    })
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }

                const data = await response.json();
                
                return {
                    success: true,
                    messageId: data.messageId || `MID_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                    data: data
                };

            } catch (error) {
                console.error('API Call failed:', error);
                
                // For educational purposes, we'll simulate success sometimes
                const shouldSucceed = Math.random() > 0.3; // 70% success rate for simulation
                
                if (shouldSucceed) {
                    return {
                        success: true,
                        messageId: `SIM_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                        note: 'Simulated success for educational purposes'
                    };
                } else {
                    return {
                        success: false,
                        error: error.message || 'Unknown API error'
                    };
                }
            }
        }

        // Add to history
        function addToHistory(phone, message, cost, messageId, status, error = null) {
            const historyEntry = {
                id: Date.now(),
                timestamp: new Date().toISOString(),
                phone: phone,
                message: message.substring(0, 100) + (message.length > 100 ? '...' : ''),
                fullMessage: message,
                type: /[^\u0000-\u00FF]/.test(message) ? 'Unicode' : 'English',
                cost: cost,
                messageId: messageId,
                status: status,
                error: error
            };

            AppState.history.unshift(historyEntry);
            
            // Keep only last 100 entries
            if (AppState.history.length > 100) {
                AppState.history = AppState.history.slice(0, 100);
            }
        }

        // Update statistics
        function updateStats(smsCount) {
            const today = new Date().toDateString();
            const month = new Date().getMonth();
            
            // Update daily stats
            if (AppState.stats.lastReset !== today) {
                AppState.stats.todayUsage = 0;
                AppState.stats.lastReset = today;
            }
            
            AppState.stats.todayUsage += smsCount;
            AppState.stats.monthUsage += smsCount;
            AppState.stats.totalSent += smsCount;
            
            updateStatsDisplay();
        }

        // UI Update Functions
        function updateBalanceDisplay() {
            document.getElementById('balanceDisplay').textContent = AppState.points;
            document.getElementById('userPointsBadge').textContent = AppState.points;
            
            // Update send button text with point info
            const sendBtn = document.getElementById('sendBtn');
            if (AppState.points <= 0) {
                sendBtn.innerHTML = '<i class="fas fa-coins me-2"></i> No Points Available';
                sendBtn.disabled = true;
            }
        }

        function updateStatsDisplay() {
            document.getElementById('todayUsage').textContent = AppState.stats.todayUsage + ' SMS';
            document.getElementById('monthUsage').textContent = AppState.stats.monthUsage + ' SMS';
            document.getElementById('totalSent').textContent = AppState.stats.totalSent + ' SMS';
        }

        function loadHistoryTable() {
            const tbody = document.getElementById('historyTableBody');
            const emptyState = document.getElementById('historyEmpty');
            
            if (AppState.history.length === 0) {
                tbody.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            tbody.innerHTML = AppState.history.map(entry => `
                <tr>
                    <td>${new Date(entry.timestamp).toLocaleString()}</td>
                    <td>${entry.phone}</td>
                    <td>${entry.message}</td>
                    <td><span class="badge ${entry.type === 'Unicode' ? 'bg-warning' : 'bg-primary'}">${entry.type}</span></td>
                    <td>${entry.cost}</td>
                    <td><span class="status-badge status-${entry.status}">${entry.status}</span></td>
                    <td><small class="text-muted">${entry.messageId ? entry.messageId.substring(0, 8) + '...' : 'N/A'}</small></td>
                </tr>
            `).join('');
        }

        function loadContactsList() {
            const contactsList = document.getElementById('contactsList');
            
            if (AppState.contacts.length === 0) {
                contactsList.innerHTML = `
                    <div class="text-center text-muted py-4">
                        <i class="fas fa-users fa-2x mb-3"></i>
                        <p>No contacts saved yet</p>
                    </div>
                `;
                return;
            }
            
            contactsList.innerHTML = AppState.contacts.map(contact => `
                <div class="contact-item">
                    <div>
                        <strong>${contact.name}</strong>
                        <div class="text-muted small">+88 ${contact.phone}</div>
                        ${contact.group ? `<span class="badge bg-secondary">${contact.group}</span>` : ''}
                    </div>
                    <div class="contact-actions">
                        <button class="btn btn-sm btn-outline-accent" onclick="useContact('${contact.phone}')">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteContact('${contact.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function loadTemplatesList() {
            const templatesList = document.getElementById('templatesList');
            
            if (AppState.templates.length === 0) {
                templatesList.innerHTML = '<div class="text-center text-muted">No templates saved</div>';
                return;
            }
            
            templatesList.innerHTML = AppState.templates.map(template => `
                <div class="card mb-2">
                    <div class="card-body p-3">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h6 class="mb-1">${template.name}</h6>
                                <p class="small text-muted mb-0">${template.message.substring(0, 50)}...</p>
                            </div>
                            <button class="btn btn-sm btn-outline-accent" onclick="useTemplate('${template.id}')">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Utility Functions
        function showToast(message, type = 'info') {
            const backgroundColor = type === 'success' ? '#4ade80' : 
                                  type === 'error' ? '#ef4444' : 
                                  type === 'warning' ? '#f59e0b' : '#4cc9f0';
            
            Toastify({
                text: message,
                duration: 3000,
                gravity: "top",
                position: "right",
                backgroundColor: backgroundColor,
                stopOnFocus: true
            }).showToast();
        }

        function toggleTheme() {
            const themeToggle = document.getElementById('themeToggle');
            if (AppState.theme === 'dark') {
                AppState.theme = 'light';
                document.body.classList.add('light-mode');
                themeToggle.classList.add('active');
            } else {
                AppState.theme = 'dark';
                document.body.classList.remove('light-mode');
                themeToggle.classList.remove('active');
            }
            saveAppData();
        }

        // Contact Management
        function addContact() {
            const phone = document.getElementById('newContactPhone').value;
            const name = document.getElementById('newContactName').value;
            const group = document.getElementById('newContactGroup').value;
            
            if (!phone || !/^01[3-9]\d{8}$/.test(phone)) {
                showToast('Please enter a valid phone number', 'error');
                return;
            }
            
            if (!name.trim()) {
                showToast('Please enter a contact name', 'error');
                return;
            }
            
            // Check if contact already exists
            if (AppState.contacts.some(c => c.phone === phone)) {
                showToast('Contact with this number already exists', 'warning');
                return;
            }
            
            const contact = {
                id: Date.now().toString(),
                phone: phone,
                name: name,
                group: group || null,
                createdAt: new Date().toISOString()
            };
            
            AppState.contacts.push(contact);
            saveAppData();
            loadContactsList();
            
            // Clear form
            document.getElementById('newContactPhone').value = '';
            document.getElementById('newContactName').value = '';
            document.getElementById('newContactGroup').value = '';
            
            showToast('Contact saved successfully', 'success');
        }

        function addContactToDatabase(phone, name) {
            if (AppState.contacts.some(c => c.phone === phone)) {
                return; // Contact already exists
            }
            
            const contact = {
                id: Date.now().toString(),
                phone: phone,
                name: name,
                createdAt: new Date().toISOString()
            };
            
            AppState.contacts.push(contact);
            saveAppData();
        }

        // Export/Import Functions
        function exportHistory() {
            const csv = convertToCSV(AppState.history);
            downloadFile(csv, 'sms_history.csv', 'text/csv');
            showToast('History exported successfully', 'success');
        }

        function exportAllData() {
            const allData = {
                points: AppState.points,
                history: AppState.history,
                contacts: AppState.contacts,
                templates: AppState.templates,
                settings: AppState.settings,
                stats: AppState.stats,
                exportedAt: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(allData, null, 2);
            downloadFile(dataStr, 'sms_pro_backup.json', 'application/json');
            showToast('All data exported successfully', 'success');
        }

        function importData() {
            const fileInput = document.getElementById('importDataFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showToast('Please select a backup file', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // Validate data structure
                    if (!data.history || !data.contacts) {
                        throw new Error('Invalid backup file format');
                    }
                    
                    // Confirm import
                    if (confirm('This will overwrite all current data. Continue?')) {
                        AppState.points = data.points || 100;
                        AppState.history = data.history || [];
                        AppState.contacts = data.contacts || [];
                        AppState.templates = data.templates || [];
                        AppState.settings = data.settings || {};
                        AppState.stats = data.stats || {};
                        
                        saveAppData();
                        initializeUI();
                        
                        showToast('Data imported successfully', 'success');
                        fileInput.value = '';
                    }
                } catch (error) {
                    console.error('Import error:', error);
                    showToast('Error importing data. Invalid file format.', 'error');
                }
            };
            
            reader.readAsText(file);
        }

        // Reset Functions
        function resetPoints() {
            if (confirm('Reset points to 100?')) {
                AppState.points = 100;
                saveAppData();
                updateBalanceDisplay();
                showToast('Points reset to 100', 'success');
            }
        }

        function clearHistory() {
            if (confirm('Clear all history? This cannot be undone.')) {
                AppState.history = [];
                saveAppData();
                loadHistoryTable();
                showToast('History cleared', 'success');
            }
        }

        function clearAllData() {
            if (confirm('Clear ALL data including contacts and settings? This cannot be undone.')) {
                AppState.points = 100;
                AppState.history = [];
                AppState.contacts = [];
                AppState.templates = [];
                AppState.settings = {
                    autoSaveContacts: false,
                    showNotifications: true,
                    enableSound: false,
                    apiEndpoint: "https://bikroy.com/data/phone_number_login/verifications/phone_login"
                };
                AppState.stats = {
                    todayUsage: 0,
                    monthUsage: 0,
                    totalSent: 0,
                    lastReset: new Date().toISOString()
                };
                
                saveAppData();
                initializeUI();
                showToast('All data cleared', 'success');
            }
        }

        // Helper Functions
        function convertToCSV(data) {
            const headers = ['Date', 'Phone', 'Message', 'Type', 'Cost', 'Status', 'Message ID'];
            const rows = data.map(item => [
                new Date(item.timestamp).toLocaleString(),
                item.phone,
                item.message,
                item.type,
                item.cost,
                item.status,
                item.messageId || 'N/A'
            ]);
            
            return [headers, ...rows].map(row => 
                row.map(cell => `"${cell}"`).join(',')
            ).join('\n');
        }

        function downloadFile(content, fileName, contentType) {
            const a = document.createElement('a');
            const file = new Blob([content], {type: contentType});
            a.href = URL.createObjectURL(file);
            a.download = fileName;
            a.click();
        }

        function updateSetting(event) {
            const settingId = event.target.id;
            const value = event.target.type === 'checkbox' ? event.target.checked : event.target.value;
            
            AppState.settings[settingId] = value;
            saveAppData();
            
            if (settingId === 'apiEndpoint') {
                showToast('API endpoint updated', 'success');
            }
        }

        function applySettingsToUI() {
            document.getElementById('autoSaveContacts').checked = AppState.settings.autoSaveContacts;
            document.getElementById('showNotifications').checked = AppState.settings.showNotifications;
            document.getElementById('enableSound').checked = AppState.settings.enableSound;
            document.getElementById('apiEndpoint').value = AppState.settings.apiEndpoint;
        }

        function filterContacts() {
            const searchTerm = document.getElementById('contactSearch').value.toLowerCase();
            const filteredContacts = AppState.contacts.filter(contact =>
                contact.name.toLowerCase().includes(searchTerm) ||
                contact.phone.includes(searchTerm) ||
                (contact.group && contact.group.toLowerCase().includes(searchTerm))
            );
            
            const contactsList = document.getElementById('contactsList');
            
            if (filteredContacts.length === 0) {
                contactsList.innerHTML = `
                    <div class="text-center text-muted py-4">
                        <p>No contacts found matching "${searchTerm}"</p>
                    </div>
                `;
                return;
            }
            
            contactsList.innerHTML = filteredContacts.map(contact => `
                <div class="contact-item">
                    <div>
                        <strong>${contact.name}</strong>
                        <div class="text-muted small">+88 ${contact.phone}</div>
                        ${contact.group ? `<span class="badge bg-secondary">${contact.group}</span>` : ''}
                    </div>
                    <div class="contact-actions">
                        <button class="btn btn-sm btn-outline-accent" onclick="useContact('${contact.phone}')">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteContact('${contact.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Global functions for inline event handlers
        window.useContact = function(phone) {
            document.getElementById('phoneNumbers').value = phone;
            validateForm();
            showToast('Phone number added to form', 'success');
        };

        window.deleteContact = function(contactId) {
            if (confirm('Delete this contact?')) {
                AppState.contacts = AppState.contacts.filter(c => c.id !== contactId);
                saveAppData();
                loadContactsList();
                showToast('Contact deleted', 'success');
            }
        };

        window.useTemplate = function(templateId) {
            const template = AppState.templates.find(t => t.id === templateId);
            if (template) {
                document.getElementById('message').value = template.message;
                document.getElementById('message').dispatchEvent(new Event('input'));
                showToast('Template loaded', 'success');
            }
        };

        function saveTemplate() {
            const message = document.getElementById('message').value.trim();
            if (!message) {
                showToast('Please enter a message first', 'error');
                return;
            }
            
            const name = prompt('Enter template name:');
            if (!name) return;
            
            const template = {
                id: Date.now().toString(),
                name: name,
                message: message,
                createdAt: new Date().toISOString()
            };
            
            AppState.templates.push(template);
            saveAppData();
            loadTemplatesList();
            showToast('Template saved', 'success');
        }

        function showContactsModal() {
            // Simple contact selection
            const numbers = AppState.contacts.map(c => c.phone);
            if (numbers.length === 0) {
                showToast('No contacts saved yet', 'warning');
                return;
            }
            
            let selected = prompt('Enter contact numbers (comma separated):\n\nSaved contacts: ' + numbers.join(', '));
            if (selected) {
                document.getElementById('phoneNumbers').value = selected;
                validateForm();
            }
        }

        // Initialize
        function updateUI() {
            updateBalanceDisplay();
            updateMessageStats();
            validateForm();
        }

    </script>
</body>
</html>
